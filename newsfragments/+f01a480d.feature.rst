Refreshed with implementation from CPython main (3.14).